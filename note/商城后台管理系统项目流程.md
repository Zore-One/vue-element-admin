## 一. 电商后台管理系统  技术要点

整体上的项目结结构是前后端分离的，

后台：php+aphce +mysql + jwt(token鉴权)

前台：vue + vue-cli + vue-router + vuex + scss + element ui + echarts(图表) + webpack(静态模块打包工具 vue项目打包优化) + axios + cookie + MD5（加密） 



## 二. 创建项目

2.1 安装  node    

node -v  如果有版本号输出，就说明安装正确了

2.2 安装 淘宝镜像  cnpm

```bash
npm install -g cnpm --registry=https://registry.npm.taobao.org
```

cnpm -v  如果有版本号输出，就说明安装正确了



 2.3 全局安装脚手架

npm i -g @vue/cli 

或

cnpm i -g @vue/cli

vue --version  如果有版本号输出，就说明安装正确了

2.4  将 项目目录定位到 E:\www文件夹下面

2.5 创建项目

vue  create shop-0726



新建项目时选择的项有：



![](E:\2021-07-26\07-vue\day11\note\img\02.bmp)



scss 选择：

![](E:\2021-07-26\07-vue\day11\note\img\03.bmp)

2.6 将项目 引入到 vscode

运行项目  

cd  shop-0726

npm run serve

在浏览器上 输入  http://127.0.0.1:8080  就可以看到网页了



## 三.安装依赖

cnpm i -S axios element-ui echarts js-cookie js-md5 

或

npm i -S  axios element-ui echarts js-cookie js-md5

## 四. 创建页面 ，配置路由

4.1 创建页面

首页src/views/home/index.vue

框架页src/views/layout/index.vue

登录src/views/login/index.vue

404页 src/views/page404/index.vue

4.2 配置路由

src/router/index.js

```js
import Vue from 'vue'
import VueRouter from 'vue-router'
import Layout from '../views/layout/index.vue'

Vue.use(VueRouter)

const routes = [
  {
    path: '/',
    name: 'Layout',
    component: Layout,
    redirect: "/home",
    children: [
      { path: "home", name: "home", component: () => import(/* webpackChunkName: "home" */ '../views/home/index.vue') }
    ]
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import(/* webpackChunkName: "login" */ '../views/login/index.vue')
  },
  {
    path: '*',
    component: () => import(/* webpackChunkName: "page404" */ '../views/page404/index.vue')
  }
]

const router = new VueRouter({
  routes
})

export default router

```



添加了 框架页的路由出口

src/views/layout/index.vue

```html
<template>
  <div>
    框架页

+    <div>
+      <router-view></router-view>
+    </div>
  </div>
</template>
<script>
export default {
  name: "layout",
  data() {
    return {};
  },
};
</script>
<style scoped>
</style>
```





## 五. 给框架页布局



5.1 删除  src/App.vue  里边的链接

```
<template>
  <div id="app">
-    <div id="nav">
-      <router-link to="/">Home</router-link> |
-      <router-link to="/about">About</router-link>
-    </div>
    <router-view/>
  </div>
</template>
```

5.2 src/views/layout/index.vue

```html
<template>
  <div class="app-wrapper">
    <div class="sidebar">左侧</div>
    <div class="main-container">
      <div class="navbar">头部</div>
      <div class="main-con">
        <router-view></router-view>
      </div>
    </div>
  </div>
</template>
<script>
export default {
  name: "layout",
  data() {
    return {};
  },
};
</script>
<style scoped lang="scss">
// lang="scss" 使用scss
.app-wrapper {
  position: relative;
  height: 100%;
  width: 100%;
  .sidebar {
    height: 100%;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 200px;
    overflow: hidden;
    background: rgb(84, 92, 100);
    color: #fff;
  }
  .main-container {
    margin-left: 200px;
    clear: both;
    min-height: 100%;
    .navbar {
      height: 50px;
      line-height: 50px;
      border-bottom: 1px solid #ccc;
      background: lightyellow;
    }
    .main-con {
      width: 100%;
    }
  }
}
</style>
```





## 六.首页的静态页渲染

6.1 将  images的图片的文件夹 拷贝到 src/assets这个下面

6.2 配置  element ui

在 src/main.js

```
//引入 element ui框架
import ElementUI from 'element-ui';
import 'element-ui/lib/theme-chalk/index.css';
Vue.use(ElementUI);
```

6. 3 修改首页的排版

src/views/home/index.vue

```html
<template>
  <div class="home-con">
    <el-row>
      <el-col
        :span="8"
        v-for="item in dingdanArr"
        :key="item.id"
        class="dingdan"
      >
        <!--  在vue的项目中 获取的是本地图片地址，并且使用变量获取时，需要使用 require -->
        <div><img :src="item.img" /></div>
        <div>
          <div>{{ item.name }}</div>
          <div>{{ item.price }}</div>
        </div>
      </el-col>
    </el-row>
  </div>
</template>
<script>
export default {
  name: "home",
  data() {
    return {
      dingdanArr: [
        {
          id: 1,
          name: "今日订单总数",
          price: "200",
          img: require("@/assets/images/home_order.png"),
        },
        {
          id: 2,
          name: "今日销售总额",
          price: "￥5000",
          img: require("@/assets/images/home_today_amount.png"),
        },
        {
          id: 3,
          name: "昨日订单总数",
          price: "￥3000",
          img: require("@/assets/images/home_yesterday_amount.png"),
        },
      ],
    };
  },
};
</script>
<style scoped>
.home-con {
  padding: 10px;
}

.dingdan {
  border: 1px solid #ccc;
  margin: 10px;
  width: 30%;
  display: flex;
  justify-content: space-around;
  border-radius: 10px;
}
</style>
```



## 七.将头部和左侧写成是组件形式

7.1 创建 头部和 左侧的组件

src/views/layout/components/Navbar.vue

```
<template>
  <div class="navbar-con">
    <div>首页</div>
    <div class="navbar-xiala">
      <el-dropdown>
        <span class="el-dropdown-link">
          <img src="@/assets/images/mz_small_icon.png" />
          <i class="el-icon-arrow-down el-icon--right"></i>
        </span>
        <el-dropdown-menu slot="dropdown">
          <el-dropdown-item>首页</el-dropdown-item>
          <el-dropdown-item>退出</el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
    </div>
  </div>
</template>

<script>
export default {
  name: "Navbar",
};
</script>

<style scoped lang="scss">
.navbar-con {
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  .navbar-xiala {
    img {
      width: 45px;
      margin-top: 2px;
    }
  }
}
</style>
```







src/views/layout/components/Sidebar.vue

```
<template>
  <div>左侧</div>
</template>

<script>
export default {
  name: "Sidebar",
};
</script>

<style>
</style>
```



修改了 框架页

src/views/layout/index.vue

```html
<template>
  <div class="app-wrapper">
    <Sidebar class="sidebar"></Sidebar>
    <div class="main-container">
      <Navbar class="navbar"></Navbar>
      <div class="main-con">
        <router-view></router-view>
      </div>
    </div>
  </div>
</template>
```



js

```js
//引入 头部和左侧的组件
import Navbar from "./components/Navbar.vue";
import Sidebar from "./components/Sidebar.vue";

export default {
  name: "layout",
  data() {
    return {};
  },
  components: { Navbar, Sidebar },
};
```



## 八.添加左侧菜单

8.1 添加 页面

商品列表 src/views/pms/product/index.vue

添加商品 src/views/pms/product/add.vue

商品分类 src/views/pms/productCate/index.vue

商品类型 src/views/pms/productAttr/index.vue

品牌管理 src/views/pms/brand/index.vue



8.2 添加路由

src/router/index.js

```js
import Vue from 'vue'
import VueRouter from 'vue-router'
import Layout from '../views/layout/index.vue'

Vue.use(VueRouter)

const routes = [
  {
    path: '/',
    name: 'Layout',
    component: Layout,
    redirect: "/home",
    children: [
      { path: "home", name: "home", component: () => import(/* webpackChunkName: "home" */ '../views/home/index.vue') }
    ]
  },
  {
    path: '/pms',
    name: 'Layout',
    component: Layout,
    redirect: "/pms/product",
    children: [
      { path: "product", name: "product", component: () => import(/* webpackChunkName: "product" */ '../views/pms/product/index.vue') },
      { path: "productadd", name: "productadd", component: () => import(/* webpackChunkName: "productadd" */ '../views/pms/product/add.vue') },
      { path: "productCate", name: "productCate", component: () => import(/* webpackChunkName: "productCate" */ '../views/pms/productCate/index.vue') },
      { path: "productAttr", name: "productAttr", component: () => import(/* webpackChunkName: "productAttr" */ '../views/pms/productAttr/index.vue') },
      { path: "brand", name: "brand", component: () => import(/* webpackChunkName: "brand" */ '../views/pms/brand/index.vue') },
    ]
  },


  {
    path: '/login',
    name: 'Login',
    component: () => import(/* webpackChunkName: "login" */ '../views/login/index.vue')
  },
  {
    path: '*',
    component: () => import(/* webpackChunkName: "page404" */ '../views/page404/index.vue')
  }
]

const router = new VueRouter({
  routes
})

export default router

```



8.3 添加 左侧菜单的小图标

将  fonts 文件夹  拷贝到   src/assets 里面 



在  src/main.js  里引入小图标

```
//引入小图标
import "./assets/fonts/iconfont.css";
```



8.4 修改 左侧菜单的组件

src/views/layout/components/Sidebar.vue

```html
<template>
  <div class="mymenu">
    <el-menu
      :default-active="$route.path"
      class="el-menu-vertical-demo"
      @open="handleOpen"
      @close="handleClose"
      background-color="#545c64"
      text-color="#fff"
      active-text-color="#ffd04b"
    >
      <!-- :default-active="$route.path" -->
      <el-menu-item index="/home">
        <router-link to="/home">
          <i class="iconfont icon-home"></i>
          <span> 首页</span>
        </router-link>
      </el-menu-item>
      <el-submenu index="2">
        <template slot="title">
          <i class="iconfont icon-shangpin-tianchong"></i>
          <span> 商品</span>
        </template>
        <el-menu-item-group>
          <el-menu-item index="/pms/product">
            <router-link to="/pms/product">
              <i class="iconfont icon-liebiao1"></i>
              <span> 商品列表</span>
            </router-link>
          </el-menu-item>
          <el-menu-item index="/pms/productadd"
            ><i class="iconfont icon-tianjia"></i
            ><span> 添加商品</span></el-menu-item
          >
          <el-menu-item index="/pms/productCate"
            ><i class="iconfont icon-fenlei1"></i
            ><span> 商品分类</span></el-menu-item
          >
          <el-menu-item index="/pms/productAttr"
            ><i class="iconfont icon-fenlei"></i
            ><span> 商品类型</span></el-menu-item
          >
          <el-menu-item index="/pms/brand"
            ><i class="iconfont icon-pinpaitemai"></i
            ><span> 品牌管理</span></el-menu-item
          >
        </el-menu-item-group>
      </el-submenu>
    </el-menu>
  </div>
</template>

<script>
export default {
  name: "Sidebar",
  mounted() {
    //当前页面的路径地址
    console.log(this.$route.path);
  },
  methods: {
    handleOpen: function () {
      console.log("菜单打开了");
    },
    handleClose: function () {
      console.log("菜单关闭了");
    },
  },
};
</script>

<style scoped lang="scss">
.mymenu {
  .el-menu {
    border-right: none;
  }
}
</style>
```



修改了 src/App.vue 的样式

```
/*修改左侧菜单的a的样式*/
a {
  text-decoration: none;
  color: inherit;
}
```



## 九.使用 echarts 制作图表

echarts  可以实现按需加载  **   优势：你需要什么模块就加载什么模块，加载的js体量小些

9.1 在 src/main.js 中引入  echarts

```
//引入图表
import * as echarts from 'echarts';
//将echarts添加到 vue的扩展属性里
Vue.prototype.$echarts = echarts;
```

9.2 在首页画图表

src/views/home/index.vue

html

```
<template>
  <div class="home-con">
    <el-row>
      <el-col :span="8" v-for="item in dingdanArr" :key="item.id">
        <!--  在vue的项目中 获取的是本地图片地址，并且使用变量获取时，需要使用 require -->
        <div class="dd_item">
          <div class="dd_img"><img :src="item.img" /></div>
          <div>
            <div>{{ item.name }}</div>
            <div>{{ item.price }}</div>
          </div>
        </div>
      </el-col>
    </el-row>

    <!-- 显示图表内容 -->
+    <div id="mychart" class="mychart"></div>
  </div>
</template>
```

js

```
mounted() {
    console.log(this.$echarts);
    //初始化 图表
    let mychart = this.$echarts.init(document.getElementById("mychart"));
    console.log(mychart);
    //画图
    mychart.setOption(this.option);
  },
```

css

```
/*想要显示 echarts的图 ，必须 设置 高度 */
.mychart {
  height: 500px;
}
```



9.3 重组数据的饼形图

src/views/home/index.vue

html  

```
 <!-- 使用后台重组数据显示商品总览饼形图 -->
    <div id="piechart" class="mychart"></div>
```

js  数据

```
data:function(){
return {

pieEcharts: {
        title: {
          text: "商品总览",
          left: "center",
        },
        tooltip: {
          trigger: "item",
        },
        legend: {
          orient: "vertical",
          left: "left",
        },
        series: [
          {
            name: "Access From",
            type: "pie",
            radius: "50%",
            data: [
              //填充后台收据
            ],
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: "rgba(0, 0, 0, 0.5)",
              },
            },
          },
        ],
      },
}
}
```



js中 添加函数和函数调用

```
mounted() {
    console.log(this.$echarts);
    this.lineEcharts();
    this.pmsEcharts();
  },

  methods: {
    lineEcharts: function () {
      //初始化 图表
      let mychart = this.$echarts.init(document.getElementById("mychart"));
      console.log(mychart);
      //画图
      mychart.setOption(this.option);
    },
    pmsEcharts: function () {
      let mychart = this.$echarts.init(document.getElementById("piechart"));
      console.log(mychart);
      //重组后台数据
      var data = [];
      this.shangpinArr.forEach((item) => {
        data.push({ value: item.num, name: item.name });
      });
      this.pieEcharts.series[0].data = data;

      //画图
      mychart.setOption(this.pieEcharts);
    },
  },
```



## 十. 商品列表获取数据并渲染

src/views/pms/product/index.vue

```html
<template>
  <div class="product-con">
    <el-card class="box-card">
      <div class="clearfix">
        <span><i class="iconfont icon-dingdan1"> </i>商品数据列表</span>
        <el-button style="float: right" type="primary" size="small"
          >添加</el-button
        >
      </div>
    </el-card>
    <!-- 使用表格显示数据  :data 表格想要显示的数据-->
    <el-table :data="productList" border style="width: 100%" class="listtable">
      <el-table-column prop="id" label="编号" width="180"> </el-table-column>
      <el-table-column label="商品图片" width="180">
        <template slot-scope="scope"><img :src="scope.row.pic" /> </template>
      </el-table-column>

      <el-table-column prop="name" label="商品名称" width="180">
      </el-table-column>
      <el-table-column label="价格/货号" width="180">
        <template slot-scope="scope">
          <div>价格：{{ scope.row.price }}</div>
          <div>货号：{{ scope.row.product_sn }}</div>
        </template>
      </el-table-column>
      <el-table-column label="审核状态" width="180">
        <template slot-scope="scope">
          {{ scope.row.verify_status | verify }}
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script>
//1.引入 axios
import axios from "axios";
export default {
  name: "product",
  data: function () {
    return {
      productList: [],
    };
  },
  //在钩子函数中获取数据
  created() {
    axios
      .get("http://www.yinruifang.cn/index/Api/product_list")
      .then((res) => {
        console.log(res);
        this.productList = res.data.product;
      });
  },
  filters: {
    verify: function (value) {
      return value ? "已审核" : "未审核";
    },
  },
};
</script>

<style scoped lang="scss">
.product-con {
  padding: 10px;
  .listtable {
    margin-top: 10px;
    img {
      width: 50px;
    }
  }
}
</style>
```



## 十一. 获取数据封装  ***

axios的封装：

封装的内容有：

1.baseUrl  请求的基础路径

2.timeout  请求的过期时间

3.请求拦截和响应拦截

请求拦截  做token验证；

响应拦截 做报错信息  405  、400、401、403  3** 5**   ；数据没有获取到时 旋转小图标

axios返回的数据是promise类型，调用时还可以使用 async await 来调用



api封装：

优势： 将 所有的后台接口的api进行统一管理，对于添加修改删除api方便



11.1 创建  src/utils/request.js ,用于 axios的封装

1.引入 axios

2.创建 axios 实例

3.配置

4.请求拦截

5.响应拦截

6.导出



 src/utils/request.js

```
// 1.引入 axios
import axios from 'axios';
import { Message } from 'element-ui';
// 2.创建 axios 实例
const service = axios.create({
    // 3.配置
    //baseURL  后三个字母是大写
    baseURL: "http://www.yinruifang.cn/index/Api",  //请求的基础路径
    timeout: 60 * 60 * 1000 //请求的超时时间
})


// 4.请求拦截

service.interceptors.request.use(
    config => {
        //设置 token
        config.headers.Authorization = "token";//token  代表从后台传过来的token的令牌
        return config;
    },
    err => {
        return Promise.reject(err);
    }
)

// 5.响应拦截
service.interceptors.response.use(
    res => {
        console.log(res);
        const data = res.data;
        //如果后台返回的报错码和报错信息的话
        if (data.status !== 200) {
            Message({
                type: "error",
                message: data.msg,
                duration: 2000
            })
        } else {
            return data;
        }
    },
    err => {
        console.log(err);
        Message({
            type: "error",
            message: err,
            duration: 2000
        })
    }
)

// 6.导出
export default service;
```



11.2 创建 src/api/product.js

用户 写 商品相关的api

```
import request from '@/utils/request.js';
//获取商品列表
export function fetchProductList(params) {
    return request({
        url: "product_list",
        method: "get",
        params: params
    })
}

```

11.3 在 商品列表中使用 这个api

src/views/pms/product/index.vue

```
+ import { fetchProductList } from "@/api/product.js";

export default {
  name: "product",
  data: function () {
    return {
      productList: [],
    };
  },
  //在钩子函数中获取数据
  created() {
  +  fetchProductList().then((res) => {
  +    this.productList = res.product;
  +  });
  },
  filters: {
    verify: function (value) {
      return value ? "已审核" : "未审核";
    },
  },
};
```





## 十二. 调用商品类型的数据 显示列表



12.1 在 src/api/product.js  添加一个 api接口

```

export function fetchProductAttrList(params) {
    return request({
        url: "get_product_attr",
        method: "get",
        params: params
    })

}
```





12.2 在 src/views/pms/productAttr/index.vue 获取api接口  ，使用

```
<template>
  <div>
    商品类型
    <el-table :data="attrList" border style="width: 100%">
      <el-table-column prop="id" label="编号" width="180"> </el-table-column>
      <el-table-column prop="name" label="类型名称" width="180">
      </el-table-column>
      <el-table-column prop="attribute_count" label="属性数量">
      </el-table-column>
      <el-table-column prop="param_count" label="参数数量"> </el-table-column>
      <el-table-column label="操作">
        <template slot-scope="scope">
          <el-button @click="handleClick(scope.row)" type="primary" size="small"
            >编辑</el-button
          >
          <el-button type="error" size="small">删除</el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script>
//引入 商品类型的  获取数据的 函数
import { fetchProductAttrList } from "@/api/product.js";
export default {
  name: "productAttr",
  data: function () {
    return {
      attrList: [],
    };
  },
  created() {
    //获取数据
    fetchProductAttrList().then((res) => {
      console.log(res);
      this.attrList = res.data;
    });
  },
  methods: {
    //编辑的函数
    handleClick: function (row) {
      console.log(row);
    },
  },
};
</script>

<style>
</style>
```





## 十三.分类列表

1.在api文件中 添加相应的接口

src/api/product.js

```
export function fetchProductCateList(params) {
    return request({
        url: "get_product_category_list/0",//从 后台api里面查找
        method: "get",
        params: params
    })
}
```

修改了 商品分类的页面

src/views/pms/productCate/index.vue

```
<template>
  <div>
    商品分类

    <el-table :data="cateList" border style="width: 100%">
      <el-table-column prop="id" label="编号" width="180"> </el-table-column>
      <el-table-column prop="name" label="类型名称" width="180">
      </el-table-column>
      <el-table-column label="级别">
        <template slot-scope="scope">
          {{ scope.row.level | levelF }}
        </template>
      </el-table-column>
      <el-table-column prop="product_count" label="商品数量"> </el-table-column>
      <el-table-column prop="product_unit" label="数量单位"> </el-table-column>
      <el-table-column label="是否显示">
        <template slot-scope="scope">
          <el-switch
            v-model="scope.row.show_status"
            :active-value="1"
            :inactive-value="0"
          >
          </el-switch>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script>
import { fetchProductCateList } from "@/api/product.js";
export default {
  name: "productCate",
  data: function () {
    return {
      cateList: [],
    };
  },
  // created() {
  //   fetchProductCateList().then((res) => {
  //     console.log(res);
  //     this.cateList = res.data;
  //   });
  // },
  //async await  generator 的语法糖，可以将异步操作转同步操作
  async created() {
    var res = await fetchProductCateList();
    this.cateList = res.data;
  },
  filters: {
    levelF: function (value) {
      return value ? "二级" : "一级";
    },
  },
};
</script>

<style>
</style>
```



## 十四. 商品列表分页

src/views/pms/product/index.vue



14.1 先将  element ui 的分页 拷贝过来,修改

```
 <el-pagination
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
      :current-page="listQuery.pageNum"
      :page-sizes="[100, 200, 300, 400]"
      :page-size="listQuery.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="total">
    </el-pagination>
```

发现 报错

将 js  添加相应的  函数  和  变量

```
data: function () {
    return {
      productList: [],
      //这是传给后台的参数
 +     listQuery: {
 +       pageSize: 10, //默认每页显示10条
 +       pageNum: 1, //默认当前页是第一页
 +     },
 +     total: 0, //总条数
    };
  },



```



添加函数

```
methods: {
    //获取列表数据
    getProductList() {
      fetchProductList(this.listQuery).then((res) => {
        console.log(res);
        this.productList = res.product;
        this.total = res.total;
      });
    },

    //修改每一页的数据条数
    handleSizeChange(val) {
      console.log("修改页面条数的函数运行了", val);
      this.listQuery.pageSize = val;
      this.listQuery.pageNum = 1;
      //获取数据
      this.getProductList();
    },
    //修改当前页的页码
    handleCurrentChange(val) {
      console.log("修改当前页的页码的函数运行了", val);
      //将页码信息 保存到  listQuery
      this.listQuery.pageNum = val;
      //再次获取数据
      this.getProductList();
    },
  },
```



需要在  created里调用  获取函数

```
 //在钩子函数中获取数据
  created() {
    this.getProductList();
  },
```





品牌的分页数据 ：  18.品牌管理获取列表，有分页和查询

类型的分页数据：  4.接口名称：获取商品类型列表

分类的分页数据： 10.获取商品分类的一级或二级数据





## 十五.商品列表的搜索功能

src/views/pms/product/index.vue

按照商品名称：

html

```
<el-card class="box-card">
      <div class="clearfix" slot="header">
        <span><i class="iconfont icon-sousuo-copy"> </i> 筛选搜索</span>
        <el-button
          style="float: right"
          type="primary"
          size="small"
          @click="onSubmit"
          >查询</el-button
        >
      </div>
      <div>
        <!-- :model 表单都绑定了哪些数据 -->
        <el-form ref="form" :model="listQuery" label-width="80px">
          <el-form-item label="商品名称">
            <el-input v-model="listQuery.name"></el-input>
          </el-form-item>
        </el-form>
      </div>
    </el-card>
```

js  data数据

```
data: function () {
    return {
      productList: [],
      //这是传给后台的参数
      listQuery: {
        pageSize: 10, //默认每页显示10条
        pageNum: 1, //默认当前页是第一页
 +       name: "", //商品名称
      },
      total: 0, //总条数
    };
  },
```



js  methods

```
//查询 商品
    onSubmit() {
      console.log("查询的函数运行了");
      console.log(this.listQuery);
      //重新获取数据
      this.getProductList();
    },
```



按照 货号：

html

```
<el-form ref="form" :model="listQuery" label-width="80px">
          <el-form-item label="商品名称">
            <el-input v-model="listQuery.name"></el-input>
          </el-form-item>
     +     <el-form-item label="货号">
     +       <el-input v-model="listQuery.product_sn"></el-input>
     +     </el-form-item>
        </el-form>
```



js data

```
 data: function () {
    return {
      productList: [],
      //这是传给后台的参数
      listQuery: {
        pageSize: 10, //默认每页显示10条
        pageNum: 1, //默认当前页是第一页
        name: null, //商品名称
 +       product_sn: null, //商品货号
      },
      total: 0, //总条数
    };
```



重置功能：

html

```
<div class="clearfix" slot="header">
        <span><i class="iconfont icon-sousuo-copy"> </i> 筛选搜索</span>
        <el-button
          style="float: right"
          type="primary"
          size="small"
          @click="onSubmit"
          >查询</el-button
        >

  +      <el-button
  +        style="float: right"
  +        type="button"
  +        size="small"
  +        @click="onReset"
  +        >重置</el-button
  +      >
      </div>
```



js  methods:

```
//重置查询条件
    onReset() {
      this.listQuery = {
        pageSize: 10, //默认每页显示10条
        pageNum: 1, //默认当前页是第一页
        name: null, //商品名称
        product_sn: null, //商品货号
      };
      //重新获取数据
      this.getProductList();
    },
```



审核状态：

html

```html
<el-form-item label="货号:">
    <el-input v-model="listQuery.product_sn"></el-input>
</el-form-item>
<el-form-item label="审核状态:">
    <el-select
               v-model="listQuery.verify_status"
               placeholder="审核状态"
               class="input-w"
               >
        <el-option label="未审核" value="0"></el-option>
        <el-option label="已审核" value="1"></el-option>
    </el-select>
</el-form-item>
```

js  data

```
 data: function () {
    return {
      productList: [],
      //这是传给后台的参数
      listQuery: {
        pageSize: 10, //默认每页显示10条
        pageNum: 1, //默认当前页是第一页
        name: null, //商品名称
        product_sn: null, //商品货号
+        verify_status: null, //审核状态
      },
      total: 0, //总条数
    };
  },
```





商品品牌添加搜索功能：

1. 在 src/api/product.js  添加接口

```
export function fetchBrand(params) {
    return request({
        url: "get_product_brand",
        method: "get",
        params: params
    })
}
```



2.在src/views/pms/product/index.vue 文件中

调用api接口

js  data

```
data: function () {
    return {
      productList: [],
      //这是传给后台的参数
      listQuery: {
        pageSize: 10, //默认每页显示10条
        pageNum: 1, //默认当前页是第一页
        name: null, //商品名称
        product_sn: null, //商品货号
        verify_status: null, //审核状态
+        brand_id: null, //品牌的id
      },
      total: 0, //总条数
+      brandOptions: [], //品牌下拉列表数据
    };
  },
```

 js  修改 的第一句话

```
-+  import { fetchProductList, fetchBrand } from "@/api/product.js";
```

 js  method

```
//获取品牌数据
    getBrand() {
      fetchBrand().then((res) => {
        console.log(res);
        this.brandOptions = res.data;
      });
    },
```

在 created  钩子中 调用一下

```
created() {
    this.getProductList();
 +   this.getBrand();
  },
```





3.将数据使用循环的形式显示在 页面上

html

```html
<el-form-item label="商品品牌:">
    <el-select
               v-model="listQuery.brand_id"
               placeholder="商品品牌"
               class="input-w"
               >
        <el-option
                   v-for="item in brandOptions"
                   :label="item.name"
                   :value="item.id"
                   :key="item.id"
                   ></el-option>
    </el-select>
</el-form-item>
```





## 16. 商品列表 分类数据的查询功能

16.1 添加  src/api/product.js

```
//获取 分类的有子节点的数据
//## 2.接口名称：获取商品分类的所有数据 ，有子节点
//http://www.yinruifang.cn/index/Api/get_product_category
export function fetchCategory(params) {
    return request({
        url: "get_product_category",
        method: "get",
        params: params
    })
}

```

   16.2 src/views/pms/product/index.vue 文件中

引入 

```
-+ import { fetchProductList, fetchBrand, fetchCategory } from "@/api/product.js";
```



添加data数据

```
 data: function () {
    return {
      productList: [],
      //这是传给后台的参数
      listQuery: {
        pageSize: 10, //默认每页显示10条
        pageNum: 1, //默认当前页是第一页
        name: null, //商品名称
        product_sn: null, //商品货号
        verify_status: null, //审核状态
        brand_id: null, //品牌的id
 +       product_category_id: null, //分类的二级id
      },
      total: 0, //总条数
      brandOptions: [], //品牌下拉列表数据
 +     categoryOptions: [], //分类的下拉列表的数据
    };
  }
```



获取数据、重组数据  methods

```
 getCategory() {
      fetchCategory().then((res) => {
        console.log(res);
        var data = res.data;
        //重组数据
        data.forEach((item) => {
          let children = [];
          //添加分类的子级数据
          item.children.forEach((i) => {
            children.push({ value: i.id, label: i.name });
          });
          this.categoryOptions.push({
            value: item.id,
            label: item.name,
            children: children,
          });
        });
        console.log(this.categoryOptions);
      });
    },
```



在钩子函数中调用数据

```
  created() {
    //调用商品列表数据
    this.getProductList();
    //调用 品牌数据
    this.getBrand();
    //调用 商品分类的数据
+    this.getCategory();
  },
```



16.3  添加 html

```

...
	+	<el-form-item label="商品分类:">
    +        <el-cascader
    +          v-model="listQuery.product_category_id"
    +          :options="categoryOptions"
    +          @change="handleChange"
    +        ></el-cascader
    +      ></el-form-item>
 </el-form>
```



16.4 添加  handleChange  函数

methods

```
//如果级联下拉菜单切换了选中项时会触发
    handleChange(value) {
      console.log("级联菜单切换了", value);
      if (value !== null && value.length === 2) {
        this.listQuery.product_category_id = value[1];
      }
    },
```



## 17.商品数据添加



17.1  在  src/api/product.js

添加  添加商品的api



接口名称：添加一条商品信息

url 地址：http://www.yinruifang.cn/index/Api/create_product

```
//添加商品的接口
// 6.接口名称：添加一条商品信息

//url地址：http://www.yinruifang.cn/index/Api/create_product

export function createProduct(data) {
    return request({
        url: "create_product",
        method: "post",
        data: data
    })
}
```



17.2 修改  src/views/product/add.vue

```
<template>
  <div>
    添加商品

    <el-form
      :model="listQuery"
      :rules="rules"
      ref="ruleForm"
      label-width="100px"
      class="demo-ruleForm"
    >
      <el-form-item label="商品分类:" prop="product_category_id">
        <el-cascader
          v-model="listQuery.product_category_id"
          :options="categoryOptions"
          @change="handleChange"
        ></el-cascader
      ></el-form-item>
      <el-form-item label="商品名称:" prop="name">
        <el-input v-model="listQuery.name"></el-input>
      </el-form-item>
      <el-form-item label="副标题:" prop="sub_title">
        <el-input v-model="listQuery.sub_title"></el-input>
      </el-form-item>
      <el-form-item label="商品品牌:" prop="brand_id">
        <el-select
          v-model="listQuery.brand_id"
          placeholder="商品品牌"
          class="input-w"
        >
          <el-option
            v-for="item in brandOptions"
            :label="item.name"
            :value="item.id"
            :key="item.id"
          ></el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="商品介绍:" prop="description">
        <el-input v-model="listQuery.description"></el-input>
      </el-form-item>
      <el-form-item label="图片链接地址:" prop="pic">
        <el-input v-model="listQuery.pic"></el-input>
      </el-form-item>
      <el-form-item label="商品货号:" prop="product_sn">
        <el-input v-model="listQuery.product_sn" class="input-width"></el-input>
      </el-form-item>
      <el-form-item label="商品售价:" prop="price">
        <el-input v-model="listQuery.price" class="input-width"></el-input>
      </el-form-item>
      <el-form-item label="市场价:" prop="original_price">
        <el-input
          v-model="listQuery.original_price"
          class="input-width"
        ></el-input>
      </el-form-item>
      <el-form-item label="商品库存:" prop="stock">
        <el-input v-model="listQuery.stock" class="input-width"></el-input>
      </el-form-item>
      <el-form-item label="计量单位:" prop="unit">
        <el-input v-model="listQuery.unit" class="input-width"></el-input>
      </el-form-item>
      <el-form-item label="商品重量:" prop="weight">
        <el-input v-model="listQuery.weight" class="input-width"></el-input>克
      </el-form-item>
      <el-form-item label="排序:" prop="sort">
        <el-input v-model="listQuery.sort" class="input-width"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="submitForm('ruleForm')"
          >立即创建</el-button
        >
        <el-button @click="resetForm('ruleForm')">重置</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script>
import { fetchBrand, fetchCategory, createProduct } from "@/api/product.js";
export default {
  name: "productadd",
  data: function () {
    return {
      //将要传给后台的数据
      listQuery: {
        brand_id: null, //商品品牌id
        brand_name: "", //商品品牌名称
        delete_status: 0, //删除标志位，默认填0，表示未删除
        description: "", //商品介绍
        name: "", //商品名称
        original_price: 0, //市场价
        pic: "", //商品图片的url地址
        price: 0, //商品售价
        product_category_id: null, //分类id
        product_category_name: "", //分类名称
        product_sn: "", //商品货号
        sort: 0, //排序
        stock: 0, //商品库存
        sub_title: "", //副标题
        unit: "", //计量单位
        weight: 0, //商品重量
        sale: 0, //商品销量
        publish_status: 0, //上架
        recommand_status: 0,
        new_status: 0,
        verify_status: 0,
      },
      //表单的验证
      rules: {
        product_category_id: [
          { required: true, message: "请选择分类", trigger: "blur" },
        ],
        name: [
          { required: true, message: "请输入商品名称", trigger: "blur" },
          {
            min: 3,
            max: 100,
            message: "长度在3-100个字符之间",
            trigger: "blur",
          },
        ],
        sub_title: [
          { required: true, message: "请输入副标题名称", trigger: "blur" },
        ],
        brand_id: [{ required: true, message: "请选择品牌", trigger: "blur" }],
        description: [
          { required: true, message: "请输入商品介绍", trigger: "blur" },
        ],
        pic: [
          { required: true, message: "请输入图片链接地址", trigger: "blur" },
        ],
      },
      brandOptions: [], //品牌下拉列表数据
      categoryOptions: [], //分类的下拉列表的数据
    };
  },
  created() {
    //调用 品牌数据
    this.getBrand();
    //调用 商品分类的数据
    this.getCategory();
  },
  methods: {
    //获取品牌数据
    getBrand() {
      fetchBrand().then((res) => {
        console.log(res);
        this.brandOptions = res.data;
      });
    },
    //获取商品分类的数据并重组
    getCategory() {
      fetchCategory().then((res) => {
        console.log(res);
        var data = res.data;
        //重组数据
        data.forEach((item) => {
          let children = [];
          //添加分类的子级数据
          item.children.forEach((i) => {
            children.push({ value: i.id, label: i.name });
          });
          this.categoryOptions.push({
            value: item.id,
            label: item.name,
            children: children,
          });
        });
        console.log(this.categoryOptions);
      });
    },
    //如果级联下拉菜单切换了选中项时会触发
    handleChange(value) {
      console.log("级联菜单切换了", value);
      if (value !== null && value.length === 2) {
        this.listQuery.product_category_id = value[1];
      }
      console.log(this.listQuery.product_category_id);
    },
    //提交 表单
    submitForm(formName) {
      console.log("表单提交了");
      this.$refs[formName].validate((valid) => {
        if (valid) {
          //填写品牌名称
          this.brandOptions.forEach((i) => {
            if (i.id == this.listQuery.brand_id) {
              this.listQuery.brand_name = i.name;
            }
          });
          //填写分类名称
          this.categoryOptions.forEach((item) => {
            item.children.forEach((i) => {
              if (i.value == this.listQuery.product_category_id) {
                this.listQuery.product_category_name = i.label;
              }
            });
          });

          //表单验证通过
          console.log("表单验证通过", this.listQuery);
          //调用后台接口将数据传给 服务器，生成一条新的数据
          createProduct(this.listQuery).then((res) => {
            console.log(res);
            if (res.msg == "添加成功") {
              this.$message({
                message: "成功添加商品",
                duration: 1000,
                type: "success",
              });
              this.$router.push("/pms/product");
            }
          });
        } else {
          console.log("表单验证没通过");
          return false;
        }
      });
    },
  },
};
</script>

<style>
.demo-ruleForm {
  width: 600px;
}
</style>
```



## 



## 18. 分类信息添加功能

18.1 添加一个页面

src/views/productCate/add.vue

```
<template>
  <div>添加商品分类</div>
</template>
<script>
export default {
  name: "productCateAdd",
  data() {
    return {};
  },
  methods: {},
  components: {},
};
</script>
<style scoped>
</style>
```

18.2 添加路由

src/router/index.js

```
children: [
      { path: "product", name: "product", component: () => import(/* webpackChunkName: "product" */ '../views/pms/product/index.vue') },
      { path: "productadd", name: "productadd", component: () => import(/* webpackChunkName: "productadd" */ '../views/pms/product/add.vue') },
      { path: "productCate", name: "productCate", component: () => import(/* webpackChunkName: "productCate" */ '../views/pms/productCate/index.vue') },
+      { path: "productCateAdd", name: "productCateAdd", component: () => import(/* webpackChunkName: "productCateAdd" */ '../views/pms/productCate/add.vue') },
      { path: "productAttr", name: "productAttr", component: () => import(/* webpackChunkName: "productAttr" */ '../views/pms/productAttr/index.vue') },
      { path: "brand", name: "brand", component: () => import(/* webpackChunkName: "brand" */ '../views/pms/brand/index.vue') },
    ]
```

18.3 修改了商品分类列表页面

src/views/productCate/index.vue



html

```
-+ <div class="pro_con">
    <el-card class="box-card">
      <div class="clearfix">
        <span> 商品分类列表</span>
        <el-button
          style="float: right"
          type="primary"
          size="mini"
          @click="goadd"
          >添加</el-button
        >
      </div>
    </el-card>
    ...
```

js

```
 methods: {
    //跳转到添加页面
    goadd: function () {
      //js里面的路由跳转
      this.$router.push("/pms/productCateAdd");
    },
  },
```



css

```
<style scoped lang="scss">
.pro_con {
  padding: 10px;
  .box-card {
    margin-bottom: 10px;
  }
}
</style>
```



18.4  写 添加分类信息的接口

src/api/product.js

```
//添加商品分类接口
//：http://www.yinruifang.cn/index/Api/create_product_cate
export function createProductCate(data) {
    return request({
        url: "create_product_cate",
        method: "post",
        data: data
    })
}
```







18. 5写 添加商品分类功能

src/views/productCate/add.vue



```html
<template>
  <div class="pro_con">
    <el-card class="box-card">
      <div class="clearfix">
        <i class="iconfont icon-sousuo-copy"> </i>
        <span> 添加商品分类</span>
      </div>
    </el-card>

    <el-form
      :model="listQuery"
      :rules="rules"
      ref="ruleForm"
      label-width="100px"
      class="demo-ruleForm"
    >
      <el-form-item label="分类名称:" prop="name">
        <el-input v-model="listQuery.name"></el-input>
      </el-form-item>
      <el-form-item label="数量单位:" prop="product_unit">
        <el-input v-model="listQuery.product_unit"></el-input>
      </el-form-item>
      <el-form-item label="排序:" prop="sort">
        <el-input v-model="listQuery.sort"></el-input>
      </el-form-item>
      <el-form-item label="是否显示:" prop="show_status">
        <el-radio-group v-model="listQuery.show_status">
          <el-radio :label="1">是</el-radio>
          <el-radio :label="0">否</el-radio>
        </el-radio-group>
      </el-form-item>
      <el-form-item label="是否显示在导航栏:" prop="nav_status">
        <el-radio-group v-model="listQuery.nav_status">
          <el-radio :label="1">是</el-radio>
          <el-radio :label="0">否</el-radio>
        </el-radio-group>
      </el-form-item>
      <el-form-item label="关键词:" prop="keywords">
        <el-input v-model="listQuery.keywords"></el-input>
      </el-form-item>
      <el-form-item label="分类描述:" prop="description">
        <el-input v-model="listQuery.description"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="submitForm('ruleForm')"
          >立即创建</el-button
        >
        <el-button @click="resetForm('ruleForm')">重置</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>
<script>
import { createProductCate } from "@/api/product.js";
export default {
  name: "productCateAdd",
  data() {
    return {
      listQuery: {
        description: "", //描述
        icon: "", //小图标
        keywords: "", //关键词
        name: "", //名称
        nav_status: 0, //是否显示在导航
        parent_id: 0, //上级节点id
        product_unit: "", //数量单位
        product_count: 0, //商品数量
        show_status: 0, //是否显示
        sort: 0, //排序
        level: 0, //0表示一级分类 1表示二级分类
      },
      rules: {
        name: [
          { required: true, message: "请输入商品分类名称", trigger: "blur" },
          {
            min: 3,
            max: 100,
            message: "长度在3-100个字符之间",
            trigger: "blur",
          },
        ],
      },
    };
  },
  methods: {
    //添加商品分类
    submitForm: function (formName) {
      console.log("表单提交了");
      this.$refs[formName].validate((valid) => {
        if (valid) {
          //表单验证通过
          console.log("表单验证通过", this.listQuery);
          //调用后台接口将数据传给 服务器，生成一条新的数据
          createProductCate(this.listQuery).then((res) => {
            console.log(res);
            if (res.msg == "添加成功") {
              this.$message({
                message: "成功添加商品分类",
                duration: 1000,
                type: "success",
              });
              this.$router.push("/pms/productCate");
            }
          });
        } else {
          console.log("表单验证没通过");
          return false;
        }
      });
    },
  },
};
</script>
<style scoped lang="scss">
.pro_con {
  padding: 10px;
  .box-card {
    margin-bottom: 10px;
  }
}
</style>
```



添加子级分类信息

js

```
-+ import { createProductCate, fetchProductCateList } from "@/api/product.js";
```





```
data() {
    return {
      listQuery: {
        description: "", //描述
        icon: "", //小图标
        keywords: "", //关键词
        name: "", //名称
        nav_status: 0, //是否显示在导航
        parent_id: 0, //上级节点id
        product_unit: "", //数量单位
        product_count: 0, //商品数量
        show_status: 0, //是否显示
        sort: 0, //排序
        level: 0, //0表示一级分类 1表示二级分类
      },
      rules: {
        name: [
          { required: true, message: "请输入商品分类名称", trigger: "blur" },
          {
            min: 3,
            max: 100,
            message: "长度在3-100个字符之间",
            trigger: "blur",
          },
        ],
      },
  +    productCateOptions: [], //上级分类的数据
    };
```





```
 created() {
    //获取顶级分类信息
    this.getProductCate();
  },
  methods: {
    getProductCate: async function () {
      const res = await fetchProductCateList();
      console.log(res);
      //this.productCateOptions = res.data;

      this.productCateOptions.push({ value: 0, label: "顶级分类" });
      res.data.forEach((item) => {
        this.productCateOptions.push({ value: item.id, label: item.name });
      });
      console.log(this.productCateOptions);
    },
    
    //添加商品分类
    submitForm: function (formName) {
      console.log("表单提交了");
      this.$refs[formName].validate((valid) => {
        if (valid) {
          //如果添加的不是顶级分类的话，需要将level的值赋值为 1
     +     if (this.listQuery.parent_id != 0) {
     +       this.listQuery.level = 1;
     +     }

          //表单验证通过
          console.log("表单验证通过", this.listQuery);
          //调用后台接口将数据传给 服务器，生成一条新的数据
          createProductCate(this.listQuery).then((res) => {
            console.log(res);
            if (res.msg == "添加成功") {
              this.$message({
                message: "成功添加商品分类",
                duration: 1000,
                type: "success",
              });
              this.$router.push("/pms/productCate");
            }
          });
        } else {
          console.log("表单验证没通过");
          return false;
        }
      });
    },
    
    ....
```





html

```
<el-form-item label="分类名称:" prop="name">
        <el-input v-model="listQuery.name"></el-input>
      </el-form-item>
      <el-form-item label="上级分类:" prop="name">
        <el-select v-model="listQuery.parent_id" placeholder="请选择">
          <el-option
            v-for="item in productCateOptions"
            :key="item.value"
            :label="item.label"
            :value="item.value"
          >
          </el-option>
        </el-select>
      </el-form-item>
      ...
```



## 19. 商品分类的列表显示  ，及 一级二级列表的切换

19.1 修改了 api接口

src/api/product.js

```
-+ export function fetchProductCateList(params,parent_id) {
    return request({
-+        url: "get_product_category_list/"+parent_id,//从 后台api里面查找
        method: "get",
        params: params
    })
}
```



19.2 修改 商品分类列表功能

src/views/pms/productCate/index.vue

html:

```
<el-card class="box-card">
      <div class="clearfix">
        <span> 商品分类列表</span>
        <el-button
          style="float: right"
          type="primary"
          size="mini"
          @click="goadd"
          >添加</el-button
        >
   +     <el-button
   +       style="float: right"
   +       type="primary"
   +       size="mini"
   +       v-if="parent_id != 0"
   +       @click="goParentLevel"
   +       >返回上一级</el-button
   +     >
      </div>
    </el-card>
```



```
....
<el-table-column label="操作">
        <template slot-scope="scope">
          <el-button
            type="primary"
            @click="showNextLevel(scope.row.id)"
            size="mini"
            :disabled="scope.row.level != 0"
            >查看下级</el-button
          >
        </template>
      </el-table-column>
    </el-table>
<el-pagination
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
      :current-page="listQuery.pageNum"
      :page-sizes="[5, 10, 15, 20]"
      :page-size="listQuery.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="total"
    >
    </el-pagination>
```



js

```
import { fetchProductCateList } from "@/api/product.js";
export default {
  name: "productCate",
  data: function () {
    return {
      cateList: [],
      listQuery: {
        pageNum: 1,
        pageSize: 10,
      },
      total: 0,
      parent_id: 0, //默认0  表示 顶级分类
    };
  },
  //async await  generator 的语法糖，可以将异步操作转同步操作
  created() {
    this.getProductCateList();
  },
  filters: {
    levelF: function (value) {
      return value ? "二级" : "一级";
    },
  },
  methods: {
    getProductCateList: async function () {
      //分页的数据需要传到 后台
      var res = await fetchProductCateList(this.listQuery, this.parent_id);
      this.cateList = res.data;
      this.total = res.total; //总条数
    },
    //跳转到添加页面
    goadd: function () {
      //js里面的路由跳转
      this.$router.push("/pms/productCateAdd");
    },
    //修改每一页的数据条数
    handleSizeChange(val) {
      console.log("修改页面条数的函数运行了", val);
      this.listQuery.pageSize = val;
      this.listQuery.pageNum = 1;
      //获取数据
      this.getProductCateList();
    },
    //修改当前页的页码
    handleCurrentChange(val) {
      console.log("修改当前页的页码的函数运行了", val);
      //将页码信息 保存到  listQuery
      this.listQuery.pageNum = val;
      //再次获取数据
      this.getProductCateList();
    },
    //查看下级
    showNextLevel: function (id) {
      this.parent_id = id;
      //重新获取数据
      this.getProductCateList();
    },
    //返回上一级
    goParentLevel: function () {
      this.parent_id = 0;
      //重新获取数据
      this.getProductCateList();
    },
  },
};
```





## 20 . 修改 商品数据

20.1  添加 修改页面

src/views/pms/product/update.vue

```
<template>
  <div>修改商品</div>
</template>
<script>
export default {
  name: "productupdate",
  data() {
    return {};
  },
  methods: {},
  components: {},
};
</script>
<style scoped>
</style>
```

20.2 添加了路由

src/router/index.js

```
children: [
      { path: "product", name: "product", component: () => import(/* webpackChunkName: "product" */ '../views/pms/product/index.vue') },
      { path: "productadd", name: "productadd", component: () => import(/* webpackChunkName: "productadd" */ '../views/pms/product/add.vue') },
  +    { path: "productupdate/:id", name: "productupdate", component: () => import(/* webpackChunkName: "productupdate" */ '../views/pms/product/update.vue') },
      { path: "productCate", name: "productCate", component: () => import(/* webpackChunkName: "productCate" */ '../views/pms/productCate/index.vue') },
      { path: "productCateAdd", name: "productCateAdd", component: () => import(/* webpackChunkName: "productCateAdd" */ '../views/pms/productCate/add.vue') },
      { path: "productAttr", name: "productAttr", component: () => import(/* webpackChunkName: "productAttr" */ '../views/pms/productAttr/index.vue') },
      { path: "brand", name: "brand", component: () => import(/* webpackChunkName: "brand" */ '../views/pms/brand/index.vue') },
    ]
```

20.3 修改了 列表页

html

```
 ...
 <el-table-column label="操作" width="180">
        <template slot-scope="scope">
          <el-button
            type="primary"
            size="mini"
            @click="updateProduct(scope.row.id)"
            >编辑</el-button
          >
          <el-button type="danger" size="mini" @click="delProduct(scope.row.id)">删除</el-button>
        </template>
      </el-table-column>
    </el-table>
```

js   methods 中添加了两个函数



```
//跳转到 修改页面
    updateProduct: function (id) {
      console.log(id);
      this.$router.push("/pms/productUpdate/"+id);
    },
    //删除的函数
    delProduct: function (id) {
      console.log(id);
    },
```

20.4 添加 api接口

src/api/product.js

```
//修改商品信息
//http://www.yinruifang.cn/index/Api/update_product
export function updateProduct(data) {
    return request({
        url: "update_product",
        method: "post",
        data: data
    })
}

//通过id获取一条商品记录
//url 地址：http://www.yinruifang.cn/index/Api/product_one
export function getProductOne(params) {
    return request({
        url: "product_one",
        method: "get",
        params: params
    })
}

```



20.5 修改 修改商品页面

src/views/pms/product/update.vue

```
<template>
  <div>
    修改商品
    <el-form
      :model="listQuery"
      :rules="rules"
      ref="ruleForm"
      label-width="100px"
      class="demo-ruleForm"
    >
      <el-form-item label="商品分类:" prop="product_category_id">
        <el-cascader
          v-model="listQuery.product_category_id"
          :options="categoryOptions"
          @change="handleChange"
        ></el-cascader
      ></el-form-item>
      <el-form-item label="商品名称:" prop="name">
        <el-input v-model="listQuery.name"></el-input>
      </el-form-item>
      <el-form-item label="副标题:" prop="sub_title">
        <el-input v-model="listQuery.sub_title"></el-input>
      </el-form-item>
      <el-form-item label="商品品牌:" prop="brand_id">
        <el-select
          v-model="listQuery.brand_id"
          placeholder="商品品牌"
          class="input-w"
        >
          <el-option
            v-for="item in brandOptions"
            :label="item.name"
            :value="item.id"
            :key="item.id"
          ></el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="商品介绍:" prop="description">
        <el-input v-model="listQuery.description"></el-input>
      </el-form-item>
      <el-form-item label="图片链接地址:" prop="pic">
        <el-input v-model="listQuery.pic"></el-input>
      </el-form-item>
      <el-form-item label="商品货号:" prop="product_sn">
        <el-input v-model="listQuery.product_sn" class="input-width"></el-input>
      </el-form-item>
      <el-form-item label="商品售价:" prop="price">
        <el-input v-model="listQuery.price" class="input-width"></el-input>
      </el-form-item>
      <el-form-item label="市场价:" prop="original_price">
        <el-input
          v-model="listQuery.original_price"
          class="input-width"
        ></el-input>
      </el-form-item>
      <el-form-item label="商品库存:" prop="stock">
        <el-input v-model="listQuery.stock" class="input-width"></el-input>
      </el-form-item>
      <el-form-item label="计量单位:" prop="unit">
        <el-input v-model="listQuery.unit" class="input-width"></el-input>
      </el-form-item>
      <el-form-item label="商品重量:" prop="weight">
        <el-input v-model="listQuery.weight" class="input-width"></el-input>克
      </el-form-item>
      <el-form-item label="排序:" prop="sort">
        <el-input v-model="listQuery.sort" class="input-width"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="submitForm('ruleForm')"
          >立即创建</el-button
        >
        <el-button @click="resetForm('ruleForm')">重置</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script>
//通过id  获取一条商品数据
import {
  fetchBrand,
  fetchCategory,
  updateProduct,
  getProductOne,
} from "@/api/product.js";
export default {
  name: "productadd",
  data: function () {
    return {
      //将要传给后台的数据
      listQuery: {
        brand_id: null, //商品品牌id
        brand_name: "", //商品品牌名称
        delete_status: 0, //删除标志位，默认填0，表示未删除
        description: "", //商品介绍
        name: "", //商品名称
        original_price: 0, //市场价
        pic: "", //商品图片的url地址
        price: 0, //商品售价
        product_category_id: null, //分类id
        product_category_name: "", //分类名称
        product_sn: "", //商品货号
        sort: 0, //排序
        stock: 0, //商品库存
        sub_title: "", //副标题
        unit: "", //计量单位
        weight: 0, //商品重量
        sale: 0, //商品销量
        publish_status: 0, //上架
        recommand_status: 0,
        new_status: 0,
        verify_status: 0,
      },
      //表单的验证
      rules: {
        product_category_id: [
          { required: true, message: "请选择分类", trigger: "blur" },
        ],
        name: [
          { required: true, message: "请输入商品名称", trigger: "blur" },
          {
            min: 3,
            max: 100,
            message: "长度在3-100个字符之间",
            trigger: "blur",
          },
        ],
        sub_title: [
          { required: true, message: "请输入副标题名称", trigger: "blur" },
        ],
        brand_id: [{ required: true, message: "请选择品牌", trigger: "blur" }],
        description: [
          { required: true, message: "请输入商品介绍", trigger: "blur" },
        ],
        pic: [
          { required: true, message: "请输入图片链接地址", trigger: "blur" },
        ],
      },
      brandOptions: [], //品牌下拉列表数据
      categoryOptions: [], //分类的下拉列表的数据
    };
  },
  created() {
    //获取一条商品信息
    console.log(this.$route.params.id);
    getProductOne({ id: this.$route.params.id }).then((res) => {
      console.log(res);
      this.listQuery = res.data;
    });

    //调用 品牌数据
    this.getBrand();
    //调用 商品分类的数据
    this.getCategory();
  },
  methods: {
    //获取品牌数据
    getBrand() {
      fetchBrand().then((res) => {
        console.log(res);
        this.brandOptions = res.data;
      });
    },
    //获取商品分类的数据并重组
    getCategory() {
      fetchCategory().then((res) => {
        console.log(res);
        var data = res.data;
        //重组数据
        data.forEach((item) => {
          let children = [];
          //添加分类的子级数据
          item.children.forEach((i) => {
            children.push({ value: i.id, label: i.name });
          });
          this.categoryOptions.push({
            value: item.id,
            label: item.name,
            children: children,
          });
        });
        console.log(this.categoryOptions);
      });
    },
    //如果级联下拉菜单切换了选中项时会触发
    handleChange(value) {
      console.log("级联菜单切换了", value);
      if (value !== null && value.length === 2) {
        this.listQuery.product_category_id = value[1];
      }
      console.log(this.listQuery.product_category_id);
    },
    //提交 表单
    submitForm(formName) {
      console.log("表单提交了");
      this.$refs[formName].validate((valid) => {
        if (valid) {
          //填写品牌名称
          this.brandOptions.forEach((i) => {
            if (i.id == this.listQuery.brand_id) {
              this.listQuery.brand_name = i.name;
            }
          });
          //填写分类名称
          this.categoryOptions.forEach((item) => {
            item.children.forEach((i) => {
              if (i.value == this.listQuery.product_category_id) {
                this.listQuery.product_category_name = i.label;
              }
            });
          });

          //表单验证通过
          console.log("表单验证通过", this.listQuery);
          //调用后台接口将数据传给 服务器，生成一条新的数据
          updateProduct(this.listQuery).then((res) => {
            console.log(res);
            if (res.msg == "修改成功") {
              this.$message({
                message: "成功修改商品",
                duration: 1000,
                type: "success",
              });
              this.$router.push("/pms/product");
            }
          });
        } else {
          console.log("表单验证没通过");
          return false;
        }
      });
    },
  },
};
</script>

<style>
.demo-ruleForm {
  width: 600px;
}
</style>
```





## 21. 删除商品数据

21.1 添加接口

src/api/product.js

```
//通过 id删除 商品数据
//http://www.yinruifang.cn/index/Api/delete_status
export function delProduct(params) {
    return request({
        url: "delete_status",
        method: "get",
        params: params
    })
}
```

21.2 修改列表页数据，添加删除功能

src/views/pms/product/index.vue



js  methods

```
 //删除的函数
    delProduct: function (id) {
      console.log(id);
      //1.删除前需要提示
      this.$confirm("此操作将永久删除该条商品数据, 是否继续?", "提示", {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        type: "warning",
      })
        .then(() => {
          delProduct({ id: id }).then((res) => {
            console.log(res);
            if (res.type == "success") {
              this.$message({
                type: "success",
                message: "删除成功!",
                duration: 2000,
              });
              //2.删除后需要刷新数据
              //重新获取数据
              this.getProductList();
            }
          });
        })
        .catch(() => {
          this.$message({
            type: "info",
            message: "已取消删除",
            duration: 2000,
          });
        });
    },
```



## 22.面包屑导航 封装

22.1 创建一个 面包屑的组件

src/components/myBreadcrumb/index.vue

```
<template>
  <div>面包屑组件</div>
</template>
<script>
export default {
  name: "myBreadcrumb",
  data() {
    return {};
  },
  methods: {},
  components: {},
};
</script>
<style scoped>
</style>
```



22.2 在 头部中使用

src/views/layout/components/Navbar.vue

```
<div class="navbar-con">
 -+   <div><myBreadcrumb></myBreadcrumb></div>
    <div class="navbar-xiala">
      <el-dropdown>
        <span class="el-dropdown-link">
          <img src="@/assets/images/mz_small_icon.png" />
          <i class="el-icon-arrow-down el-icon--right"></i>
        </span>
        <el-dropdown-menu slot="dropdown">
          <el-dropdown-item>首页</el-dropdown-item>
          <el-dropdown-item>退出</el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
    </div>
  </div>
```

js

```
//  引入 面包屑的组件
import myBreadcrumb from "@/components/myBreadcrumb";
export default {
  name: "Navbar",
  components: {
    myBreadcrumb,
  },
};
```







22.3 修改路由 src/router/index.js

```
const routes = [
  {
    path: '/',
    name: 'home',
 +   meta: { title: "首页" },
    component: Layout,
    redirect: "/home",
    children: [
      { path: "home", 
  +    meta: { title: "首页" },
      name: "myhome", component: () => import(/* webpackChunkName: "home" */ '../views/home/index.vue') }
    ]
  },
  {
    path: '/pms',
    name: 'pms',
 +   meta: { title: "商品" },
    component: Layout,
    redirect: "/pms/product",
    children: [
      { path: "product", name: "product", meta: { title: "商品列表" }, component: () => import(/* webpackChunkName: "product" */ '../views/pms/product/index.vue') },
      { path: "productadd", name: "productadd", meta: { title: "添加商品" }, component: () => import(/* webpackChunkName: "productadd" */ '../views/pms/product/add.vue') },
      { path: "productupdate/:id", name: "productupdate", meta: { title: "修改商品" }, component: () => import(/* webpackChunkName: "productupdate" */ '../views/pms/product/update.vue') },
      { path: "productCate", name: "productCate", meta: { title: "商品分类列表" }, component: () => import(/* webpackChunkName: "productCate" */ '../views/pms/productCate/index.vue') },
      { path: "productCateAdd", name: "productCateAdd", meta: { title: "添加商品分类" }, component: () => import(/* webpackChunkName: "productCateAdd" */ '../views/pms/productCate/add.vue') },
      { path: "productAttr", name: "productAttr", meta: { title: "商品类型列表" }, component: () => import(/* webpackChunkName: "productAttr" */ '../views/pms/productAttr/index.vue') },
      { path: "brand", name: "brand", meta: { title: "商品品牌列表" }, component: () => import(/* webpackChunkName: "brand" */ '../views/pms/brand/index.vue') },
    ]
  },
```





22.4修改 面包屑的组件

src/components/myBreadcrumb/index.vue

```
<template>
  <div class="breadcon">
    <el-breadcrumb separator="/" class="bread">
      <el-breadcrumb-item v-for="(item, index) in breadData" :key="index">
        <template v-if="item !== breadData.length - 1">
          <!-- 有链接地址的元素 -->
          <router-link :to="item.path">{{ item.meta.title }}</router-link>
        </template>
        <template v-else>
          <!-- 没有链接的元素 -->
          {{ item.meta.title }}
        </template>
      </el-breadcrumb-item>
    </el-breadcrumb>
  </div>
</template>
<script>
export default {
  name: "myBreadcrumb",
  data() {
    return {
      breadData: [], //保存面包屑的多级导航内容
    };
  },
  mounted() {
    //获取面包屑导航的数
    this.getBreadData();
  },
  //监听路由变化
  watch: {
    $route() {
      this.getBreadData();
    },
  },
  methods: {
    getBreadData: function () {
      console.log(this.$route);
      let bread = this.$route.matched;
      console.log(bread);
      //判断是不是首页
      if (bread[1].path != "/home") {
        //不是首页
        this.breadData = [{ path: "/home", meta: { title: "首页" } }].concat(
          bread
        );
      } else {
        //是首页
        this.breadData = [{ path: "/home", meta: { title: "首页" } }];
      }

      //this.breadData = bread;
      console.log(this.breadData);
    },
  },
  components: {},
};
</script>
<style scoped lang="scss">
.breadcon {
  height: 50px;
  line-height: 50px;
  .bread {
    height: 50px;
    line-height: 50px;
    display: inline-block;
  }
}
</style>
```



## 23. 使用 vuex 完成左侧菜单的状态变化

原因是： 左侧菜单在 Sidebar.vue中 ，汉堡包 菜单在 Navbar.vue  ,点击  Navbar中的汉堡包，导致  左侧菜单会有开合的变化，  所以需要 使用 vuex



23.1 创建 了  菜单的子树

src/store/modules/app.js

```
//菜单的子树
const app = {
    //菜单状态的初始值
    state: {
        sidebar: {
            opened: false //false  菜单 是关闭的  ，true  菜单时 打开的
        }
    },
    //mutations 修改 store中的状态值
    mutations: {
        TOGGLE_SIDEBAR: (state) => {
            state.sidebar.opened = !state.sidebar.opened;
        }
    },
    //actions 可以将状态值提交给mutations ，一般的大数据量或 异步操作
    actions: {
        TOGGLE_SIDEBAR_AC: ({ commit }) => {
            commit('TOGGLE_SIDEBAR');
        }
    }
}

//导出
export default app;

```

23.2 将子树  引入到 根节点 src/store/index.js

```
import Vue from 'vue'
import Vuex from 'vuex'
//引入子树
+ import app from './modules/app';

Vue.use(Vuex)

export default new Vuex.Store({
+ getters: {//state的派生状态
+    sidebar: (state) => state.app.sidebar
+  },
  modules: {
    //注册子树
+    app
  }
})
```



23.3 在左侧菜单中 使用  vuex里面的 状态值

src/views/layout/components/Sidebar.vue

```
<el-menu
      :default-active="$route.path"
      class="el-menu-vertical-demo"
      @open="handleOpen"
      @close="handleClose"
      background-color="#545c64"
      text-color="#fff"
      active-text-color="#ffd04b"
+      :collapse="!sidebar.opened"
    >
    ...
```

js

```
//引入getters的辅助函数
+ import { mapGetters } from "vuex";
export default {
  name: "Sidebar",
  mounted() {
    //当前页面的路径地址
    console.log(this.$route.path);
  },
  methods: {
    handleOpen: function () {
      console.log("菜单打开了");
    },
    handleClose: function () {
      console.log("菜单关闭了");
    },
  },
+  computed: {
+    ...mapGetters(["sidebar"]),
+  },
};
```

23.4 修改 左侧菜单 合起来的样式 

src/views/layout/index.vue

```
 <div class="app-wrapper">
-+    <Sidebar class="sidebar" :class="sidebar.opened ? 's-w' : 's-w2'"></Sidebar>
-+    <div class="main-container" :class="sidebar.opened ? 'm-left' : 'm-left2'">
      <Navbar class="navbar"></Navbar>
      <div class="main-con">
        <router-view></router-view>
      </div>
    </div>
  </div>
```



js

```
+ import { mapGetters } from "vuex";

export default {
  name: "layout",
  data() {
    return {};
  },
+  computed: {
+    ...mapGetters(["sidebar"]),
+  },
  components: { Navbar, Sidebar },
};
```

css

```
.app-wrapper {
  position: relative;
  height: 100%;
  width: 100%;
  .sidebar {
    height: 100%;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;

    overflow: hidden;
    background: rgb(84, 92, 100);
    color: #fff;
  }
+  .s-w {
+    width: 200px;
+  }
+  .s-w2 {
+    width: 64px;
+  }
  .main-container {
    clear: both;
    min-height: 100%;
    .navbar {
      height: 50px;
      line-height: 50px;
      border-bottom: 1px solid #ccc;
      background: lightyellow;
    }
    .main-con {
      width: 100%;
    }
  }
+  .m-left {
+    margin-left: 200px;
+  }
+  .m-left2 {
+    margin-left: 64px;
+  }
}
```



23.5 修改  头部数据,点击汉堡包的按钮后 ，左侧菜单跟着变化，并且 汉堡包有一个 旋转的小动画

src/views/layout/components/Navbar.vue

html

```
 <div class="navbar-left">
      <i
        class="iconfont icon-hanbaobao hbb"
        :class="{ 'is-active': !sidebar.opened }"
        @click="changeSidebar"
      ></i>
      <myBreadcrumb></myBreadcrumb>
    </div>
```

js

```
//  引入 面包屑的组件
import myBreadcrumb from "@/components/myBreadcrumb";
import { mapGetters } from "vuex";
export default {
  name: "Navbar",
  components: {
    myBreadcrumb,
  },
  methods: {
    changeSidebar() {
      //修改 左侧菜单的状态值，需要 调用  store 中的actions
      this.$store.dispatch("TOGGLE_SIDEBAR_AC");
    },
  },
  computed: {
    ...mapGetters(["sidebar"]),
  },
};
```

css

```
.navbar-con {
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  .navbar-left {
    display: flex;
    margin-left: 20px;
    .icon-hanbaobao {
      margin-right: 10px;
    }
    .hbb {
      transform: rotate(0deg);
      transition: 1s;
      transform-origin: 50% 50%;
    }
    .is-active {
      transform: rotate(90deg);
    }
  }
  .navbar-xiala {
    img {
      width: 45px;
      margin-top: 2px;
    }
  }
}
```





## 24. 了解 jwt 

使用JWT进行鉴权的工作流程如下（重点）：

- 用户使用用户名密码来请求服务器
- 服务器进行验证用户的信息（查数据库）
- 服务器通过验证发送给用户一个token（令牌）
- 客户端存储token（Vuex+localStorage），并在每次请求时附送上这个token值
- 服务端验证token值，并返回数据

 

\1. 对称加密

对称加密指的就是加密和解密使用同一个秘钥，所以叫做对称加密。对称加密只有一个秘钥，作为私钥。

常见的对称加密算法：DES，AES，3DES等等。

 

\2. 非对称加密

非对称加密指的是：加密和解密使用不同的秘钥，一把作为公开的公钥，另一把作为私钥。公钥加密的信息，只有私钥才能解密。私钥加密的信息，只有公钥才能解密。

常见的非对称加密算法：RSA，ECC



JWT是由三段信息构成的（头部、载荷、签名），将这三部分使用`.`连接在一起就组成了JWT字符串，形如：

~~~jwt
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImp0aSI6IjNmMmc1N2E5MmFhIn0.eyJpYXQiOjE1NTk1Mjk1MjksImlzcyI6Imh0dHA6XC9cL3d3dy5weWcuY29tIiwiYXVkIjoiaHR0cDpcL1wvd3d3LnB5Zy5jb20iLCJuYmYiOjE1NTk1Mjk1MjgsImV4cCI6MTU1OTUzMzEyOSwianRpIjoiM2YyZzU3YTkyYWEiLCJ1c2VyX2lkIjoxfQ.4BaThL6_TbIMBGLIWZgpnoDQ-JlAjzbiK3y3BcvNiGI
~~~

![](.\img\jwt登录流程.png)





登录：

1.创建 登录页面，点击登录按钮时，首先 需要 通过  validate的验证，调用  vuex 里面的  Login  action

2.Login  的action 里面 ，先做加密处理（MD5），调用 后台的登录接口（src/api/user.js）

3.后台  会接收到 用户名和密码，去 数据库比对，如果失败 直接返回失败的错误信息，登录成功，颁发token

4.前台 接收到 登录成功后的数据（用户id、用户名字、用户的权限。。。），token。将用户数据和 token 保存到 cookie（localStorage、sessionStorage），

5.对于调用后台的其他接口，调用时，需要在 头部添加  token的数据，再获取后台数据

6.在后台 验证  token的信息是否正确，是否过期，如果  是正确的并且不过期，从数据库获取数据，返回正确数据到 前台

7.所有的后台系统 ，除了 登录和 404 页面之外，都做了 路由守卫





## 25.登录的部分代码

25.1 登录页面

src/views/login/index.vue

```
<template>
  <div>
    <el-card class="box-card">
      <div class="clearfix box-title" slot="header">
        <span>0726电商后台管理系统</span>
      </div>
      <el-form
        :model="ruleForm"
        status-icon
        :rules="rules"
        ref="ruleForm"
        label-width="100px"
        class="demo-ruleForm"
      >
        <el-form-item label="用户名：" prop="username">
          <el-input
            type="text"
            v-model="ruleForm.username"
            autocomplete="off"
          ></el-input>
        </el-form-item>
        <el-form-item label="密码：" prop="password">
          <el-input
            type="password"
            v-model="ruleForm.password"
            autocomplete="off"
          ></el-input>
        </el-form-item>

        <el-form-item>
          <el-button type="primary" @click="submitForm('ruleForm')"
            >提交</el-button
          >
          <el-button @click="resetForm('ruleForm')">重置</el-button>
        </el-form-item>
      </el-form>
    </el-card>
  </div>
</template>
<script>
export default {
  name: "login",
  data() {
    return {
      ruleForm: {},
      rules: {
        username: [
          { required: true, message: "请输入用户名", trigger: "blur" },
          {
            min: 3,
            max: 15,
            message: "长度在 3 到 15 个字符",
            trigger: "blur",
          },
        ],
        password: [{ required: true, message: "请输入密码", trigger: "blur" }],
      },
    };
  },
  methods: {
    submitForm(formName) {
      this.$refs[formName].validate((valid) => {
        if (valid) {
          alert("submit!");
          //调用了 store 中的 action（写了登录操作）
        } else {
          console.log("error submit!!");

          return false;
        }
      });
    },
    resetForm(formName) {
      this.$refs[formName].resetFields();
    },
  },
};
</script>
<style scoped lang="scss">
.box-card {
  width: 500px;
  height: 400px;
  margin: 100px auto;
  .box-title {
    background: #409eff;
    color: #fff;
    font-size: 30px;
    font-weight: bold;
    text-align: center;
    height: 80px;
    line-height: 80px;
  }
}
</style>
```



25.2 登录接口 创建  src/api/user.js

```
import request from '@/utils/request.js';
//登录
//url 地址：http://www.yinruifang.cn/index/Api/login
export function Login(data) {
    return request({
        url: "login",
        method: "post",
        data: data
    })
}
```



25.3 将  cookie 进行封装处理



创建  src/utils/support.js   ,添加 cookie 的 添加  修改 和 删除操作

```
//封装了cookie
import Cookie from 'js-cookie';

//创建cookie
//key  键  value 值   expires 过期时间 
export function setCookie(key, value, expires) {
    return Cookie.set(key, value, { expires: expires })
}

//获取 cookie
export function getCookie(key) {
    return Cookie.get(key);
}
//删除cookie

export function removeCookie(key) {
    return Cookie.remove(key);
}
```



25.4 创建  用户 store 的子树

 state: {

​    name: "",//登录后的中文名字

​    roleid: "" //登录后的角色id ，1 超级管理员 ，2 普通用户

  },

超级管理员 可以有更高级的权限，比如:添加用户 、给普通用户分配权限、删除用户、修改用户信息、将用户关进小黑屋、冻结用户



src/srore/modules/user.js

```
// vuex store 用户信息处理的子树
import md5 from 'js-md5';
//import { setCookie, getCookie } from '@/utils/support';
//引入 登录的接口
import { Login } from '@/api/user.js';
import { setCookie } from '../../utils/support';

//定义子树
const user = {
    state: {
        name: "",//登录后的中文名字
        roleid: "" //登录后的角色id  ，1 超级管理员  ，2 普通用户
    },
    mutations: {
        //设置中文名
        SET_NAME: (state, name) => {
            state.name = name;
        },
        //设置用户id
        SET_ROLEID: (state, roleid) => {
            state.roleid = roleid;
        }
    },
    actions: {
        //登录操作
        //userInfo 包括  用户名和密码
        LOGIN_AC: ({ commit }, userInfo) => {
            return new Promise((resolve) => {
                console.log(commit);
                // console.log(userInfo);
                //解构
                const { username, password } = userInfo;
                console.log(username);
                //将密码做加密处理
                //加盐加密
                console.log(md5(password + md5(password).substr(10, 10) + 2014));
                userInfo.password = md5(password + md5(password).substr(10, 10) + 2014);
                //调用后台接口  用户名 ：admin  密码：123456
                Login(userInfo).then(res => {
                    console.log(res);
                    //登录成功后将 登录的数据和 token 保存到 缓存中
                    setCookie("token", res["token"], 1);
                    setCookie("name", res["name"], 1);
                    setCookie("roleid", res["roleid"], 1);
                    setCookie("username", res["username"], 1);

                    //设置 store
                    commit("SET_NAME", res['name']);
                    commit("SET_ROLEID", res['roleid']);
                    //如果 有正确的返回值  ，使用  resolve带回
                    resolve(res);
                })
            })
        }
    }
}
export default user;
```



25.5 将 子树添加到 树根

src/store/index.js

```
import Vue from 'vue'
import Vuex from 'vuex'
//引入子树
import app from './modules/app';
+ import user from './modules/user';
Vue.use(Vuex)

export default new Vuex.Store({
  getters: {//state的派生状态
    sidebar: (state) => state.app.sidebar,
+    name: (state) => state.user.name,
+    roleid: (state) => state.user.roleid
  },
  modules: {
    //注册子树
    app,
  +  user
  }
})
```





25.6  修改登录页面

js

```
submitForm(formName) {
      this.$refs[formName].validate((valid) => {
        if (valid) {
          console.log("submit!");
          //调用了 store 中的 action（写了登录操作）
          this.$store.dispatch("LOGIN_AC", this.ruleForm).then((res) => {
            console.log(res);
            if (res.status == 200) {
              this.$message({
                message: "恭喜你，登录成功",
                type: "success",
                duration: 1000,
              });
              this.$router.push("/");
            }
          });
        } else {
          console.log("error submit!!");

          return false;
        }
      });
```





## 26.路由守卫

路由守卫的分类：

全局守卫   全局前置守卫 beforeEach     全局后置钩子   全局解析守卫

路由级守卫 专门给某个 路由写的守卫 

组件级守卫   

进入组件的守卫 （beforeRouteEnter）   组件更新时的守卫（beforeRouteUpdate）    组件离开时的守卫（beforeRouteLeave）



创建  文件  src/permission.js 

```
//路由守卫
//引入 路由
import router from './router';
//引入 cookie
import { getCookie } from '@/utils/support.js';

//守卫
/*
beforeEach 里面是一个函数 ，这个函数中有三个参数  to  from   next
*/

/*
登录页不需要守卫，
如果没有登录 ，跳转 登录页
如果已经登录 ，放行
*/

//不需要守卫的页面白名单
const whiteList = ['/login'];
router.beforeEach((to, from, next) => {
    console.log(to, from);
    //判断是否登录，可以使用 token进行判断
    if (getCookie("token")) {//登录了
        if (to.path == "/login") {
            next("/home");
        } else {
            //放行
            next();
        }
    } else {//没登录
        //如果在白名单 放行
        if (whiteList.indexOf(to.path) !== -1) {
            //放行
            next();
        } else {
            //不在白名单 ，跳转到 登录页
            next("/login");
        }
    }
})
```



在  src/main.js 中引入

```
//引入图表
import * as echarts from 'echarts';

//引入 路由守卫
+ import "./permission.js";

//将echarts添加到 vue的扩展属性里
Vue.prototype.$echarts = echarts;
Vue.config.productionTip = false
```



## 27.登录后显示  用户名称 在 头部

src/views/layout/components/Navbar.vue

html:

```
<div class="navbar-xiala">
 +     <span> 欢迎 {{ name }} 登录后台管理系统</span>
      <el-dropdown>
        <span class="el-dropdown-link">
          <img src="@/assets/images/mz_small_icon.png" />
          <i class="el-icon-arrow-down el-icon--right"></i>
        </span>
        <el-dropdown-menu slot="dropdown">
          <el-dropdown-item>首页</el-dropdown-item>
          <el-dropdown-item>退出</el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
    </div>
```

js

```
 computed: {
-+    ...mapGetters(["sidebar", "name"]),
  },
```



修改  src/store/modules/user.js

```
state: {
  -+      name: getCookie('name') || "",//登录后的中文名字
  -+      roleid: getCookie('roleid') || "" //登录后的角色id  ，1 超级管理员  ，2 普通用户
    },
```





按快捷键  ctrl+shift+delete  清除 所有 cookie

退出登录状态了



## 28. 退出 操作

分成  前台退出（将 所有 cookie  清除）和 后台退出（调用后台接口 ，在数据库中 记录退出的状态，退出的时间）

前端（客户端）缓存 ：localStorage  sessionStorage

后端（服务器端）缓存：session    redis

跨前端和后端： cookie



在  vuex中  实现 退出操作 src/store/modules/user.js 

写在 actions 登录 动作的后面

```
 //退出操作
        LOGOUT_AC: ({ commit }) => {
            //设置 store
            commit("SET_NAME", "");
            commit("SET_ROLEID", "");

            //清除 cookie
            removeCookie("token");
            removeCookie("name");
            removeCookie("roleid");
            removeCookie("username");
        }
```

在 头部 调用  退出登录的action

src/views/layout/components/Navbar.vue

html

```
<el-dropdown-menu slot="dropdown">
          <el-dropdown-item
     -+       ><router-link to="/">首页</router-link></el-dropdown-item
          >
          <!-- 在组件上绑定原生事件 native -->
      -+    <el-dropdown-item @click.native="logout">退出</el-dropdown-item>
        </el-dropdown-menu>
```

js

```
methods: {
    changeSidebar() {
      //修改 左侧菜单的状态值，需要 调用  store 中的actions
      this.$store.dispatch("TOGGLE_SIDEBAR_AC");
    },
    //下面的函数是新加的
    logout() {
      console.log(42);
      //调用一下  vuex 中 action
      this.$store.dispatch("LOGOUT_AC");
      //强制刷新页面
      //location.reload();
      this.$router.go(0);
    },
  },
```





## 29 . token

jwt  (json web token  )

token 的作用 是防攻击  

axios 请求拦截 可以配置  token。那么每次请求服务器端数据，都会在头部带上这个token，到服务器端后，会验证token，如果验证通过，再给数据，如果后台验证不通过，不给数据。

网站模拟请求 攻击服务器的话，token不能模拟；后台的token验证有过期时间，如果在 15分钟之内，没有操作页面，默认 token就过期了。

如果token 过期了或者token 出错，后台会给出提示，自动退出，让用户重新登录；

重新登录后，后台的服务器会重新颁发token



src/utils/request.js

```
//引入 cookie
import { getCookie } from '@/utils/support.js';



service.interceptors.request.use(
    config => {
        //设置 token
  -+      config.headers.Authorization = getCookie('token');//token  代表从后台传过来的token的令牌
        return config;
    },
    err => {
        return Promise.reject(err);
    }
)
```

每次 登录后 ，服务器都会给用户分配不同的token 的值

token 出错或 过期时需要强制退出  src/utils/request.js

```
// 1.引入 axios
import axios from 'axios';
import { Message, MessageBox } from 'element-ui';
//引入 cookie
import { getCookie } from '@/utils/support.js';
//引入了vuex
import store from '../store/index.js';
// 2.创建 axios 实例
const service = axios.create({
    // 3.配置
    //baseURL  后三个字母是大写
    baseURL: "http://www.yinruifang.cn/index/Api",  //请求的基础路径
    //baseURL: "http://192.168.1.8:8001/index/Api",  //请求的基础路径 只用于演示，看一下 token错误时的效果

    timeout: 60 * 1000 //请求的超时时间
})


// 4.请求拦截
service.interceptors.request.use(
    config => {
        //设置 token
        config.headers.Authorization = getCookie('token');//token  代表从后台传过来的token的令牌
        return config;
    },
    err => {
        return Promise.reject(err);
    }
)

// 5.响应拦截
service.interceptors.response.use(
    res => {
        //console.log(res);
        const data = res.data;
        //如果后台返回的报错码和报错信息的话
        if (data.status !== 200) {
            //有可能 报错  等于 401  ,token 出错，  需要让用户重新登录
            //强制退出的功能
            if (data.status == 401) {
                MessageBox.confirm('您的token出错，您是留在这个页面上还是重新登录?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {//点击确认按钮
                    //退出登录，刷新页面
                    store.dispatch('LOGOUT_AC');
                    //重新刷新页面
                    location.reload();

                }).catch(() => {
                    console.log("在原页面");
                });
            } else {
                Message({
                    type: "error",
                    message: data.msg,
                    duration: 2000
                })
            }
        } else {
            return data;
        }
    },
    err => {
        console.log(err);
        Message({
            type: "error",
            message: err,
            duration: 2000
        })
    }
)

// 6.导出
export default service;
```





## 30. 用户权限

页面权限   有权限的用户可以进入页面，没有权限的用户不能进入页面

注意： 验证写在路由守卫中

按钮权限  有权限的用户 可以点击  或显示该按钮 ；没有权限的用户 点击后 报"您没有权限"，或者按钮都不显示

注意： 直接写在页面上，调用 vuex 中保存的  权限信息 ，比如 ： roleid 

添加了 超级管理员页面  

src/views/super/index.vue

```
<template>
  <div>
    超级管理员操作页面 ，
    封号、冻结账号、小黑屋、删除用户、创建新用户、修改用户权限
  </div>
</template>
<script>
export default {
  name: "Super",
  data() {
    return {};
  },
  methods: {},
  components: {},
};
</script>
<style scoped>
</style>
```

添加  相应的路由

src/ruoter/index.js

```
{
    path: '/',
    name: 'home',
    meta: { title: "首页" },
    component: Layout,
    redirect: "/home",
    children: [
      { path: "home", meta: { title: "首页" }, name: "myhome", component: () => import(/* webpackChunkName: "home" */ '../views/home/index.vue') },
 +     { path: "super", meta: { title: "管理员页面" }, name: "super", component: () => import(/* webpackChunkName: "super" */ '../views/super/index.vue') },
    ]
  },
```

修改了 左侧菜单

src/views/layout/components/Sidebar.vue

html

```
 <el-menu-item index="/home">
        <router-link to="/home">
          <i class="iconfont icon-home"></i>
          <span> 首页</span>
        </router-link>
      </el-menu-item>
   +   <el-menu-item index="/super" v-if="roleid == 1">
   +     <router-link to="/super">
   +       <i class="iconfont icon-home"></i>
   +       <span> 超级管理员</span>
   +     </router-link>
   +   </el-menu-item>
   ...
```

js

```
computed: {
 -+   ...mapGetters(["sidebar", "roleid"]),
  },
```



如果 在 url地址中 直接输入  地址，超级管理员的页面还能够进去，需要 使用  页面权限

修改  src/permission.js

```
//路由守卫
//引入 路由
import router from './router';
//引入 cookie
import { getCookie } from '@/utils/support.js';
import { Message } from 'element-ui';
import store from './store';

//守卫
/*
beforeEach 里面是一个函数 ，这个函数中有三个参数  to  from   next
*/

/*
登录页不需要守卫，
如果没有登录 ，跳转 登录页
如果已经登录 ，放行
*/

//不需要守卫的页面白名单
const whiteList = ['/login'];
router.beforeEach((to, from, next) => {
    console.log(to, from);
    //判断是否登录，可以使用 token进行判断
    if (getCookie("token")) {//登录了
        if (to.path == "/login") {
            next("/home");
        } else if (to.path == "/super") {//超级管理员页面
            //判断roleid是否是超级管理员
            if (getCookie('roleid') == 1) {
                next();
            } else {//非超级管理员身份
                //提示没有权限，退出，刷新页面
                Message({
                    message: "您没有权限访问该页面，请退出后使用 超级管理员身份登录",
                    type: "error",
                    duration: 2000
                })
                store.dispatch('LOGOUT_AC');
                router.go(0);
            }
        } else {
            //放行
            next();
        }
    } else {//没登录
        //如果在白名单 放行
        if (whiteList.indexOf(to.path) !== -1) {
            //放行
            next();
        } else {
            //不在白名单 ，跳转到 登录页
            next("/login");
        }
    }
})
```



## 31.vue 打包   打包配置

npm run serve  运行项目

npm run build 打包项目

为什么要打包项目呢？

1.打包项目 可以 对代码进行压缩和整理，大小更小，更适合部署到服务器上

2.使用 webpack打包时对 代码是做了优化处理

3.打包后的代码 可以脱离 node-modules 独立使用，只要部署到服务器上就可以了

4.打包后 图片是不是进行了压缩，图片是直接拷贝到 dist文件夹中的，没有进行任何其他处理



打包后，会在 项目的根目录 生成一个 dist文件夹，就是打包好的项目





## 32.打包及部署流程：

0.需要 配置  vue.config.js

```
//webpack 扩展配置的文件
// vue.config.js   的文件放在  项目根目录中的，名字和 位置都不能更改
module.exports = {
    publicPath: './'  //项目打包时使用的，表示根目录，避免一些错误

}
```

![](.\img\config的位置.png)

1.打包前执行 npm  run serve  命令，看一下 项目是否能正常运行，在打包前需要将  proxy的配置删除，在打包后需要配置 nginx

2.打包 执行 npm  run build 命令 ，会生成  dist文件夹

3.打开 小皮   ，首页   开启  apache 服务

4.点击网站，创建网站，新建网站项目

![](.\img\在小皮中添加项目时需要填写的内容.png)

5.将  dist 文件夹里面的内容拷贝到  项目的根目录（项目的右侧  点击 管理按钮 -选择打开根目录）下

6.在浏览器上输入http://127.0.0.1:3002/index.html  ，显示 项目







## 33. webpack  优化处理

1. 在项目的根目录 创建  vue.config.js

   ```
   //webpack 扩展配置的文件
   // vue.config.js   的文件放在  项目根目录中的，名字和 位置都不能更改
   //引入  UglifyPlugin
   const UglifyPlugin = require('uglifyjs-webpack-plugin')
   const path = require('path');
   module.exports = {
       publicPath: './',  //项目打包时使用的，表示根目录，避免一些错误
       outputDir: "mydist",//打包后代码的输出文件夹名称
       lintOnSave: process.env.NODE_ENV !== 'production', // eslint-loader 是否在保存的时候检查，生产环境下不检查语法  性能会更优
       productionSourceMap: false, // 生产环境是否生成 sourceMap 文件, 显示源文件错误在第几行，有利于调试;false 优化性能
   
       configureWebpack: (config) => {
           //绝对路径
           Object.assign(config, {
               // 开发生产共同配置
               resolve: {
                   alias: {
                       '@': path.resolve(__dirname, './src'),
                       '@c': path.resolve(__dirname, './src/components'),
                       '@v': path.resolve(__dirname, './src/views')
                   } // 别名配置
               }
           })
           if (process.env.NODE_ENV === 'production') {//process.env.NODE_ENV 获取环境信息
               // 为生产环境修改配置...
               config.mode = 'production'
               // 将每个依赖包打包成单独的js文件
               let optimization = {
                   runtimeChunk: 'single',
                   splitChunks: {
                       chunks: 'all',
                       maxInitialRequests: Infinity,
                       minSize: 20000,
                       cacheGroups: {
                           vendor: {
                               test: /[\\/]node_modules[\\/]/,
                               name(module) {
                                   // get the name. E.g. node_modules/packageName/not/this/part.js
                                   // or node_modules/packageName
                                   const packageName = module.context.match(/[\\/]node_modules[\\/](.*?)([\\/]|$)/)[1]
                                   // npm package names are URL-safe, but some servers don't like @ symbols
                                   return `npm.${packageName.replace('@', '')}`
                               }
                           }
                       }
                   },
                   minimizer: [new UglifyPlugin({
                       uglifyOptions: {
                           compress: {
                               //warnings: false,
                               drop_console: true, // console
                               drop_debugger: false,
                               pure_funcs: ['console.log'] // 移除console
                           }
                       }
                   })]
               }
               Object.assign(config, {
                   optimization
               })
           }
   
       }
   
   
   }
   ```

   

**webpack  优化处理**

1. publicPath:"./" ,配置根目录，避免一些找不到 css找不到 图片的错误

2. outputDir  打包后代码的输出文件夹名称
3. lintOnSave: process.env.NODE_ENV !== 'production', // eslint 是否在保存的时候检查，生产环境下不检查语法  性能会更优
4. productionSourceMap: false, // 生产环境是否生成 sourceMap 文件, true 显示源文件错误在第几行，有利于调试;false  在生产环境下   不生成 sourceMap 文件 ，优化性能
5. 对  src   src/components  src/views   ...进行别名配置
6. 设置 optimization里面的 splitChunks，可以将 打包后 文件的大小还是比较大的文件进行拆分，一般是将chunk-vendors.js文件进行拆分处理，npm 分包处理 
7. 在  uglifyOptions 中，可以设置  去掉   打印和调试



注意：vue的  新版本  vue-cli  安装的项目，vue-cli已经内置了 webpack配置，不需要手动 写 配置项，有可能需要优化。

整理一下这个项目的知识点、项目实现





**你对webpack了解么？**

1.**webpack** 是一个用于现代 JavaScript 应用程序的 *静态模块打包工具*

2.入口  entry 可以配置一个或多个入口

3.出口 output  可以配置一个或多个

4.loader 配置解析 html, css  /scss/less  ,ts,json  xml ,img

5.plugin   解析  ts的插件、解析 xml 的插件、UglifyPlugin、分包处理的插件、自动生成 index.html的插件、服务器的热更新热启动的插件

6.模式 mode  开发环境模式  生产环境模式



**webpack  和  grunt  glup 的区别？**

**webpack  和 gulp grunt 的区别**：只需要进行简单的合并、压缩，就使用grunt/gulp即可。

但是如果整个项目使用了模块化管理，而且相互依赖非常强，我们就可以使用更加强大的webpack了。

所以，grunt/gulp和webpack有什么不同呢？

**grunt/gulp更加强调的是前端流程的自动化，模块化不是它的核心。webpack更加强调模块化开发管理，而文件压缩合并、预处理等功能，是他附带的功能**

Webpack是一个前端模块化方案，更侧重模块打包。我们可以把开发中的所有资源（图片、js文件、css文件等）都看成模块，通过loader（加载器）和plugins（插件）对资源进行处理，打包成符合生产环境部署的前端资源。
Webpack就是需要通过其配置文件（Webpack.config.js）中 entry 配置的一个入口文件（JS文件），然后在解析过程中，发现其他的模块，如scss等文件，再调用配置的loader或者插件对相关文件进行解析处理。



微信搜索：  前端面试星球    高级前端面试   前端面试咖